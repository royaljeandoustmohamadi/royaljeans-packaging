# ğŸ­ Royal Jeans - Ø³Ø§Ø®ØªØ§Ø± Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
## New Database Structure & Backend Adaptation Plan

---

## ğŸ“‹ Ù…Ø´Ú©Ù„Ø§Øª Ø³Ø§Ø®ØªØ§Ø± ÙØ¹Ù„ÛŒ

### 1. Ø¬Ø¯ÙˆÙ„ Orders Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ú¯Ø³ØªØ±Ø¯Ù‡ (84 ÙÛŒÙ„Ø¯)
- Ø³Ø§ÛŒØ²Ù‡Ø§ Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù‡Ø§Ø±Ø¯Ú©Ø¯ (`size30_healthy`, `size31_healthy`...)
- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØ² ÛŒØ§ Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØºÛŒÛŒØ± Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø±Ø¯
- Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ Ø¨Ø³ÛŒØ§Ø± Ø³Ø®Øª

### 2. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø³ÛŒØ³ØªÙ… Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø± (Workflow)
- Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø±Ø§Ø­Ù„ Ù…Ø®ØªÙ„ÙÛŒ Ø¯Ø§Ø±Ù†Ø¯: Ù¾Ø§Ø±Ú†Ù‡ â†’ Ø¯ÙˆØ®Øª â†’ Ø³Ù†Ú¯â€ŒØ´ÙˆÛŒÛŒ â†’ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
- ÙØ¹Ù„ÛŒ ÙÙ‚Ø· Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù†Ù‡ ÙˆØ¶Ø¹ÛŒØª Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ

### 3. Ø¹Ø¯Ù… Ø§Ø±ØªØ¨Ø§Ø· Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø§ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø±Ø§Ù†
- ÙÙ‚Ø· Ù†Ø§Ù… Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± Ø¨Ù‡ ØµÙˆØ±Øª String Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- Ø§Ù…Ú©Ø§Ù† Ø±Ù‡Ú¯ÛŒØ±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ø± Ø¨Ø§ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯

### 4. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø³ÛŒØ³ØªÙ… Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
- ÙÙ‚Ø· Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬ Ú©Ø§Ù„Ø§ Ø«Ø¨Øª Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

### 5. Ø¹Ø¯Ù… ØªÙÚ©ÛŒÚ© Ù…Ø­ØµÙˆÙ„Ø§Øª
- Ù‡Ø± Ø³ÙØ§Ø±Ø´ = ÛŒÚ© Ù…Ø­ØµÙˆÙ„ (Ø¯Ø± Ø­Ø§Ù„ÛŒ Ú©Ù‡ ÛŒÚ© Ø³ÙØ§Ø±Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú†Ù†Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯)

---

## âœ… Ø®Ù„Ø§ØµÙ‡ Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡

Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯Ù‡Ø§ØŒ Ø§ÛŒÙ† Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯:

| Ù…ÙˆØ±Ø¯ | ØªØºÛŒÛŒØ± |
|------|-------|
| **OrderItemSize** | Ø­Ø°Ù `sizeCategoryId` (redundant) - ÙÙ‚Ø· `sizeId` Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø´Ø¯ |
| **Workflow** | ØªØºÛŒÛŒØ± Ø§Ø² `orderId` Ø¨Ù‡ `orderItemId` - Ù‡Ø± Ø¢ÛŒØªÙ… Ù…Ø±Ø§Ø­Ù„ Ù…ØªÙØ§ÙˆØª Ø¯Ø§Ø±Ø¯ |
| **Inventory** | ØªÙÚ©ÛŒÚ© Ø¨Ù‡ `ProductInventory` Ùˆ `MaterialInventory` - Ø¨Ø¯ÙˆÙ† nullable |
| **Material Stock** | Ø­Ø°Ù `currentStock` - Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø² Ø·Ø±ÛŒÙ‚ View |
| **Contractor Rating** | Ø­Ø°Ù ÙÛŒÙ„Ø¯ `rating` - Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø² Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† evaluations |
| **StageHistory** | ØªØºÛŒÛŒØ± `action` Ø§Ø² String Ø¨Ù‡ Enum (`StageAction`) |
| **Payments** | Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¬Ø¯ÙˆÙ„ `Payment` Ø¨Ø±Ø§ÛŒ Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ú†Ú© Ùˆ Ø§Ù‚Ø³Ø§Ø· |

---

## ğŸ— Ø³Ø§Ø®ØªØ§Ø± Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

### ERD Ú©Ù„ÛŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Users       â”‚     â”‚     Roles       â”‚     â”‚  Permissions    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ email           â”‚â—„â”€â”€â”€â”€â”¤ name            â”‚     â”‚ name            â”‚
â”‚ password        â”‚     â”‚ description     â”‚     â”‚ resource        â”‚
â”‚ roleId (FK)     â”‚â”€â”€â”€â”€â–ºâ”¤ isActive        â”‚â—„â”€â”€â”€â”€â”¤ action          â”‚
â”‚ profile         â”‚     â”‚ createdAt       â”‚     â”‚ roleId (FK)     â”‚
â”‚ createdAt       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ creates
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Orders      â”‚â”€â”€â”€â”€â–ºâ”‚   OrderItems    â”‚â”€â”€â”€â”€â–ºâ”‚  OrderItemSizes â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ orderNumber     â”‚     â”‚ orderId (FK)    â”‚     â”‚ orderItemId(FK) â”‚
â”‚ customerName    â”‚     â”‚ productId (FK)  â”‚â”€â”€â”€â”€â–ºâ”¤ sizeCategoryId  â”‚
â”‚ orderDate       â”‚     â”‚ quantity        â”‚     â”‚ sizeId (FK)     â”‚
â”‚ deliveryDate    â”‚     â”‚ unitPrice       â”‚     â”‚ quantity        â”‚
â”‚ status          â”‚     â”‚ notes           â”‚     â”‚ producedQty     â”‚
â”‚ priority        â”‚     â”‚ createdAt       â”‚     â”‚ packedQty       â”‚
â”‚ totalAmount     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ createdBy (FK)  â”‚              â”‚
â”‚ createdAt       â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ uses
         â”‚                       â–¼
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚    Products     â”‚
         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚              â”‚ id (PK)         â”‚
         â”‚              â”‚ code            â”‚
         â”‚              â”‚ name            â”‚
         â”‚              â”‚ categoryId (FK) â”‚
         â”‚              â”‚ styleId (FK)    â”‚
         â”‚              â”‚ fabricId (FK)   â”‚
         â”‚              â”‚ isActive        â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ has
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OrderItemWorkflowâ”‚    â”‚ WorkflowStages  â”‚     â”‚  StageHistory   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ orderItemId(FK) â”‚â”€â”€â”€â”€â–ºâ”¤ name            â”‚â—„â”€â”€â”€â”€â”¤ workflowId (FK) â”‚
â”‚ stageId (FK)    â”‚â”€â”€â”€â”€â–ºâ”¤ order           â”‚     â”‚ action (enum)   â”‚
â”‚ contractorId(FK)â”‚     â”‚ isActive        â”‚     â”‚ contractorId(FK)â”‚
â”‚ status          â”‚     â”‚ description     â”‚     â”‚ quantity        â”‚
â”‚ startDate       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ createdAt       â”‚
â”‚ endDate         â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ notes           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Payment     â”‚     â”‚  ProductInventoryâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ orderId (FK)    â”‚â—„â”€â”€â”€â”€â”¤ productId (FK)  â”‚
â”‚ amount          â”‚     â”‚ type (enum)     â”‚
â”‚ type (enum)     â”‚     â”‚ quantity        â”‚
â”‚ status (enum)   â”‚     â”‚ warehouseId(FK) â”‚
â”‚ paidAt          â”‚     â”‚ createdAt       â”‚
â”‚ dueDate         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MaterialInventoryâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ materialId (FK) â”‚
â”‚ type (enum)     â”‚
â”‚ quantity        â”‚
â”‚ warehouseId(FK) â”‚
â”‚ expiryDate      â”‚
â”‚ createdAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Contractors    â”‚     â”‚ ContractorTypes â”‚     â”‚  Evaluations    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ name            â”‚     â”‚ name            â”‚     â”‚ contractorId(FK)â”‚
â”‚ typeId (FK)     â”‚â”€â”€â”€â”€â–ºâ”¤ slug            â”‚â—„â”€â”€â”€â”€â”¤ evaluatedBy(FK) â”‚
â”‚ phone           â”‚     â”‚ description     â”‚     â”‚ criteriaId (FK) â”‚
â”‚ address         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ score           â”‚
â”‚ isActive        â”‚                             â”‚ comments        â”‚
â”‚ rating (comp.)  â”‚                             â”‚ createdAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Inventory     â”‚     â”‚ InventoryTypes  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ type (IN/OUT)   â”‚     â”‚ name            â”‚
â”‚ productId (FK)  â”‚â”€â”€â”€â”€â–ºâ”¤ category        â”‚
â”‚ quantity        â”‚     â”‚ unit            â”‚
â”‚ referenceType   â”‚     â”‚ minStock        â”‚
â”‚ referenceId     â”‚     â”‚ maxStock        â”‚
â”‚ notes           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ createdBy (FK)  â”‚
â”‚ createdAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SizeCategories â”‚     â”‚     Sizes       â”‚     â”‚  ProductSizes   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â—„â”€â”€â”€â”€â”¤ categoryId (FK) â”‚     â”‚ productId (FK)  â”‚
â”‚ name            â”‚     â”‚ id (PK)         â”‚     â”‚ sizeId (FK)     â”‚
â”‚ slug            â”‚     â”‚ name            â”‚     â”‚ isActive        â”‚
â”‚ displayOrder    â”‚     â”‚ displayOrder    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ isActive        â”‚     â”‚ isActive        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuditLogs     â”‚     â”‚    Settings     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ userId (FK)     â”‚     â”‚ key             â”‚
â”‚ action          â”‚     â”‚ value           â”‚
â”‚ entityType      â”‚     â”‚ group           â”‚
â”‚ entityId        â”‚     â”‚ isEditable      â”‚
â”‚ oldValues (JSON)â”‚     â”‚ createdAt       â”‚
â”‚ newValues (JSON)â”‚     â”‚ updatedAt       â”‚
â”‚ ipAddress       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ createdAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Ø¬Ø²Ø¦ÛŒØ§Øª Ø¬Ø¯Ø§ÙˆÙ„ Ø¬Ø¯ÛŒØ¯

### 1. Users (Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ Ø´Ø¯Ù‡)
```prisma
model User {
  id            Int       @id @default(autoincrement())
  email         String    @unique
  password      String
  
  // Profile Info
  firstName     String?
  lastName      String?
  nickname      String?   // Ù†Ø§Ù… Ù…Ø³ØªØ¹Ø§Ø±
  avatar        String?
  phone         String?
  bio           String?
  
  // Role & Status
  roleId        Int
  role          Role      @relation(fields: [roleId], references: [id])
  isActive      Boolean   @default(true)
  lastLoginAt   DateTime?
  
  // Relations
  orders        Order[]
  orderWorkflows OrderWorkflow[]
  evaluations   ContractorEvaluation[]
  auditLogs     AuditLog[]
  inventoryLogs Inventory[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([email])
  @@index([roleId])
  @@index([isActive])
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  slug        String       @unique
  description String?
  isActive    Boolean      @default(true)
  
  users       User[]
  permissions Permission[]
  
  createdAt   DateTime     @default(now())
}

model Permission {
  id       Int    @id @default(autoincrement())
  roleId   Int
  role     Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  resource String // 'orders', 'contractors', 'reports', 'inventory', '*'
  action   String // 'create', 'read', 'update', 'delete', '*'
  scope    String @default("all") // 'all', 'own', 'department'
  // 'own' = ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø®ÙˆØ¯Ø´ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡
  // 'department' = Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù† Ø®ÙˆØ¯Ø´
  
  @@unique([roleId, resource, action])
  @@index([roleId])
}
```

**ØªØºÛŒÛŒØ±Ø§Øª:**
- ØªÙÚ©ÛŒÚ© Ù†Ø§Ù… Ø¨Ù‡ firstName Ùˆ lastName
- Ø³ÛŒØ³ØªÙ… Ù†Ù‚Ø´ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡â€ŒØªØ±
- Ø§Ù…Ú©Ø§Ù† ØªØ¹Ø±ÛŒÙ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†Ù‚Ø´
- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† `scope` Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒ ('all', 'own', 'department')

---

### 1.1 Ø³Ø·ÙˆØ­ Ø¯Ø³ØªØ±Ø³ÛŒ Ùˆ Ù†Ù‚Ø´â€ŒÙ‡Ø§ (RBAC)

#### Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡

| Ù†Ù‚Ø´ | Ù…Ø³Ø¦ÙˆÙ„ÛŒØª | Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ù„ÛŒ |
|-----|---------|-----------|
| **ADMIN** | Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ… | Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§ |
| **MANAGER** | Ù…Ø¯ÛŒØ± ØªÙˆÙ„ÛŒØ¯ | Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§ØªØŒ Ú¯Ø²Ø§Ø±Ø´Ø§ØªØŒ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø±Ø§Ù†ØŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† |
| **PRODUCTION** | ØªÙˆÙ„ÛŒØ¯ | ÙÙ‚Ø· Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø± Ùˆ Ù…Ø±Ø§Ø­Ù„ ØªÙˆÙ„ÛŒØ¯ |
| **WAREHOUSE** | Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø± | Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒØŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒØŒ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡ |
| **SALES** | ÙØ±ÙˆØ´ | Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ØŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¶Ø¹ÛŒØª (ÙÙ‚Ø· Ø³ÙØ§Ø±Ø´Ø§Øª Ø®ÙˆØ¯Ø´) |
| **ACCOUNTANT** | Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± | Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø§Ù„ÛŒØŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ØŒ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨ |

#### ØªØ¹Ø±ÛŒÙ Permissions Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†Ù‚Ø´

```javascript
// config/permissions.js

const ROLE_PERMISSIONS = {
  admin: [
    { resource: '*', action: '*', scope: 'all' } // Ù‡Ù…Ù‡ Ú†ÛŒØ²
  ],
  
  manager: [
    { resource: 'orders',      action: 'create', scope: 'all' },
    { resource: 'orders',      action: 'read',   scope: 'all' },
    { resource: 'orders',      action: 'update', scope: 'all' },
    { resource: 'orders',      action: 'delete', scope: 'all' },
    { resource: 'contractors', action: 'create', scope: 'all' },
    { resource: 'contractors', action: 'read',   scope: 'all' },
    { resource: 'contractors', action: 'update', scope: 'all' },
    { resource: 'reports',     action: 'read',   scope: 'all' },
    { resource: 'reports',     action: 'export', scope: 'all' },
    { resource: 'users',       action: 'read',   scope: 'all' },
    { resource: 'products',    action: 'read',   scope: 'all' },
    { resource: 'inventory',   action: 'read',   scope: 'all' },
    { resource: 'payments',    action: 'read',   scope: 'all' },
  ],
  
  production: [
    { resource: 'orders',    action: 'read',   scope: 'all' },
    { resource: 'workflow',  action: 'read',   scope: 'all' },
    { resource: 'workflow',  action: 'update', scope: 'all' },
    { resource: 'workflow',  action: 'create', scope: 'all' },
    { resource: 'inventory', action: 'read',   scope: 'all' },
    { resource: 'products',  action: 'read',   scope: 'all' },
  ],
  
  warehouse: [
    { resource: 'inventory', action: 'create', scope: 'all' },
    { resource: 'inventory', action: 'read',   scope: 'all' },
    { resource: 'inventory', action: 'update', scope: 'all' },
    { resource: 'materials', action: 'create', scope: 'all' },
    { resource: 'materials', action: 'read',   scope: 'all' },
    { resource: 'materials', action: 'update', scope: 'all' },
    { resource: 'orders',    action: 'read',   scope: 'all' },
    { resource: 'products',  action: 'read',   scope: 'all' },
  ],
  
  sales: [
    { resource: 'orders',   action: 'create', scope: 'all' },
    { resource: 'orders',   action: 'read',   scope: 'own' }, // ÙÙ‚Ø· Ø³ÙØ§Ø±Ø´ Ø®ÙˆØ¯Ø´
    { resource: 'orders',   action: 'update', scope: 'own' },
    { resource: 'products', action: 'read',   scope: 'all' },
    { resource: 'payments', action: 'read',   scope: 'own' },
  ],
  
  accountant: [
    { resource: 'orders',   action: 'read',   scope: 'all' },
    { resource: 'payments', action: 'create', scope: 'all' },
    { resource: 'payments', action: 'read',   scope: 'all' },
    { resource: 'payments', action: 'update', scope: 'all' },
    { resource: 'reports',  action: 'read',   scope: 'all' },
    { resource: 'reports',  action: 'export', scope: 'all' },
    { resource: 'contractors', action: 'read', scope: 'all' },
  ],
};

module.exports = { ROLE_PERMISSIONS };
```

#### Seed Roles Ùˆ Permissions

```javascript
// prisma/seed-roles.js
async function seedRoles() {
  const roles = [
    { name: 'Admin',       slug: 'admin',       description: 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ… - Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„' },
    { name: 'Manager',     slug: 'manager',     description: 'Ù…Ø¯ÛŒØ± ØªÙˆÙ„ÛŒØ¯' },
    { name: 'Production',  slug: 'production',  description: 'Ù…Ø³Ø¦ÙˆÙ„ ØªÙˆÙ„ÛŒØ¯' },
    { name: 'Warehouse',   slug: 'warehouse',   description: 'Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±' },
    { name: 'Sales',       slug: 'sales',       description: 'Ú©Ø§Ø±Ø´Ù†Ø§Ø³ ÙØ±ÙˆØ´' },
    { name: 'Accountant',  slug: 'accountant',  description: 'Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±' },
  ];

  for (const roleData of roles) {
    const role = await prisma.role.upsert({
      where: { slug: roleData.slug },
      update: {},
      create: roleData,
    });

    // Add permissions for this role
    const permissions = ROLE_PERMISSIONS[roleData.slug];
    if (permissions) {
      for (const perm of permissions) {
        await prisma.permission.upsert({
          where: {
            roleId_resource_action: {
              roleId: role.id,
              resource: perm.resource,
              action: perm.action,
            },
          },
          update: { scope: perm.scope },
          create: {
            roleId: role.id,
            resource: perm.resource,
            action: perm.action,
            scope: perm.scope,
          },
        });
      }
    }
  }
}
```

---

### 2. Orders & OrderItems (Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ Ø§Ø³Ø§Ø³ÛŒ)
```prisma
model Order {
  id              Int           @id @default(autoincrement())
  orderNumber     String        @unique
  customerName    String
  customerPhone   String?
  
  // Dates
  orderDate       DateTime      @default(now())
  deliveryDate    DateTime?
  completedAt     DateTime?
  
  // Status & Priority
  status          OrderStatus   @default(PENDING)
  priority        Priority      @default(NORMAL)
  
  // Financial
  totalAmount     Decimal       @default(0)
  paidAmount      Decimal       @default(0)
  discountAmount  Decimal       @default(0)
  
  // Notes
  description     String?
  internalNotes   String?
  
  // Relations
  items           OrderItem[]
  payments        Payment[]
  
  createdBy       Int
  creator         User          @relation(fields: [createdBy], references: [id])
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([orderNumber])
  @@index([status])
  @@index([orderDate])
  @@index([customerName])
}

model OrderItem {
  id              Int               @id @default(autoincrement())
  orderId         Int
  order           Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId       Int
  product         Product           @relation(fields: [productId], references: [id])
  
  // Quantity & Price
  quantity        Int
  unitPrice       Decimal
  totalPrice      Decimal
  
  // Size Breakdown
  sizes           OrderItemSize[]
  
  // Workflow tracking per item
  workflows       OrderItemWorkflow[]
  
  // Status
  status          ItemStatus        @default(PENDING)
  
  notes           String?
  createdAt       DateTime          @default(now())
  
  @@index([orderId])
  @@index([productId])
  @@index([status])
}

model OrderItemSize {
  id              Int           @id @default(autoincrement())
  orderItemId     Int
  orderItem       OrderItem     @relation(fields: [orderItemId], references: [id], onDelete: Cascade)
  
  // Size (includes category through Size â†’ SizeCategory relation)
  sizeId          Int
  size            Size          @relation(fields: [sizeId], references: [id])
  
  // Quantities
  orderedQty      Int
  producedQty     Int           @default(0)
  packagedQty     Int           @default(0)
  deliveredQty    Int           @default(0)
  
  @@index([orderItemId])
  @@index([sizeId])
}

enum OrderStatus {
  PENDING         // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
  CONFIRMED       // ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡
  IN_PROGRESS     // Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…
  READY           // Ø¢Ù…Ø§Ø¯Ù‡ ØªØ­ÙˆÛŒÙ„
  DELIVERED       // ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
  CANCELLED       // Ù„ØºÙˆ Ø´Ø¯Ù‡
}

enum ItemStatus {
  PENDING
  FABRIC_READY
  IN_PRODUCTION
  IN_WASH
  IN_PACKAGING
  READY
  DELIVERED
}

enum Priority {
  LOW
  NORMAL
  HIGH
  URGENT
}
```

---

### 2.1 Payment Tracking (Ø¬Ø¯ÛŒØ¯ - Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§)
```prisma
model Payment {
  id              Int           @id @default(autoincrement())
  
  orderId         Int
  order           Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  // Payment Details
  amount          Decimal
  type            PaymentType   // CASH, CHECK, TRANSFER, CARD
  
  // For checks
  checkNumber     String?
  checkBank       String?
  checkDueDate    DateTime?
  
  // Status
  status          PaymentStatus @default(PENDING)
  
  // Dates
  paidAt          DateTime?     // Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù‚Ø¹ÛŒ
  dueDate         DateTime?     // ØªØ§Ø±ÛŒØ® Ø³Ø±Ø±Ø³ÛŒØ¯ (Ø¨Ø±Ø§ÛŒ Ú†Ú©)
  
  // Reference
  referenceCode   String?       // Ø´Ù…Ø§Ø±Ù‡ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ/Ø±Ø³ÛŒØ¯
  
  // Notes
  notes           String?
  
  // Audit
  createdBy       Int
  creator         User          @relation(fields: [createdBy], references: [id])
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([orderId])
  @@index([status])
  @@index([dueDate])
  @@index([type])
}

enum PaymentType {
  CASH        // Ù†Ù‚Ø¯ÛŒ
  CHECK       // Ú†Ú©
  TRANSFER    // ÙˆØ§Ø±ÛŒØ²/Ø§Ù†ØªÙ‚Ø§Ù„
  CARD        // Ú©Ø§Ø±ØªØ®ÙˆØ§Ù†
  CREDIT      // Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
}

enum PaymentStatus {
  PENDING     // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
  PAID        // Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡
  BOUNCED     // Ø¨Ø±Ú¯Ø´Øª Ø®ÙˆØ±Ø¯Ù‡ (Ú†Ú©)
  CANCELLED   // Ù„ØºÙˆ Ø´Ø¯Ù‡
}
```

**Ù…Ø²Ø§ÛŒØ§:**
- Ø³ÙØ§Ø±Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú†Ù†Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- Ù‡Ø± Ù…Ø­ØµÙˆÙ„ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú†Ù†Ø¯ Ø³Ø§ÛŒØ² Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- Ø±Ù‡Ú¯ÛŒØ±ÛŒ ØªØ¹Ø¯Ø§Ø¯ ØªÙˆÙ„ÛŒØ¯ØŒ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ ØªØ­ÙˆÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø³Ø§ÛŒØ²
- Ø¨Ø¯ÙˆÙ† limit Ø¯Ø± ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§ÛŒØ²Ù‡Ø§

---

### 3. Products (Ø¬Ø¯ÛŒØ¯)
```prisma
model Product {
  id              Int             @id @default(autoincrement())
  code            String          @unique
  name            String
  description     String?
  
  // Relations
  categoryId      Int?
  category        ProductCategory? @relation(fields: [categoryId], references: [id])
  
  styleId         Int?
  style           Style?           @relation(fields: [styleId], references: [id])
  
  fabricId        Int?
  fabric          Fabric?          @relation(fields: [fabricId], references: [id])
  
  // Available Sizes for this product
  availableSizes  ProductSize[]
  
  // Default Prices by Category
  prices          ProductPrice[]
  
  // Images
  images          ProductImage[]
  
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // Relations
  orderItems      OrderItem[]
  
  @@index([code])
  @@index([categoryId])
  @@index([isActive])
}

model ProductCategory {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  slug        String    @unique
  description String?
  isActive    Boolean   @default(true)
  
  products    Product[]
  
  createdAt   DateTime  @default(now())
}

model ProductSize {
  id          Int       @id @default(autoincrement())
  productId   Int
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  sizeId      Int
  size        Size      @relation(fields: [sizeId], references: [id])
  
  isActive    Boolean   @default(true)
  
  @@unique([productId, sizeId])
}

model ProductPrice {
  id              Int           @id @default(autoincrement())
  productId       Int
  product         Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  sizeCategoryId  Int
  sizeCategory    SizeCategory  @relation(fields: [sizeCategoryId], references: [id])
  
  price           Decimal
  effectiveFrom   DateTime      @default(now())
  effectiveTo     DateTime?
  
  isActive        Boolean       @default(true)
  
  @@index([productId])
  @@index([sizeCategoryId])
}

model ProductImage {
  id          Int       @id @default(autoincrement())
  productId   Int
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  url         String
  alt         String?
  isPrimary   Boolean   @default(false)
  sortOrder   Int       @default(0)
  
  createdAt   DateTime  @default(now())
  
  @@index([productId])
}
```

---

### 4. Size Management (Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ)
```prisma
model SizeCategory {
  id              Int               @id @default(autoincrement())
  name            String            @unique  // Ø³Ø§Ù„Ù…ØŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒØŒ Ù†Ù…ÙˆÙ†Ù‡ØŒ Ø§Ø³ØªÙˆÚ©
  slug            String            @unique  // healthy, economy-1, economy-2, economy-3, sample, stock
  displayOrder    Int               @default(0)
  isActive        Boolean           @default(true)
  description     String?
  
  // Relations
  sizes           Size[]
  orderItemSizes  OrderItemSize[]
  productPrices   ProductPrice[]
  
  createdAt       DateTime          @default(now())
  
  @@index([slug])
  @@index([displayOrder])
}

model Size {
  id              Int               @id @default(autoincrement())
  categoryId      Int
  category        SizeCategory      @relation(fields: [categoryId], references: [id])
  
  name            String            // 30, 31, 32...
  displayOrder    Int               @default(0)
  isActive        Boolean           @default(true)
  
  // Relations
  orderItemSizes  OrderItemSize[]
  productSizes    ProductSize[]
  
  @@unique([categoryId, name])
  @@index([categoryId])
}
```

**Ù…Ø²Ø§ÛŒØ§:**
- Ø§Ù…Ú©Ø§Ù† Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØ² ÛŒØ§ Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ú©Ø¯
- Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø³Ø§ÛŒØ²Ù‡Ø§
- ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØ²Ù‡Ø§ÛŒ Ø®Ø§Øµ

---

### 5. Order Workflow (Ø¬Ø¯ÛŒØ¯ - Ø³ÛŒØ³ØªÙ… Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø±)
```prisma
model OrderItemWorkflow {
  id              Int             @id @default(autoincrement())
  
  // Workflow per OrderItem (not Order) - each item can have different stages
  orderItemId     Int
  orderItem       OrderItem       @relation(fields: [orderItemId], references: [id], onDelete: Cascade)
  
  stageId         Int
  stage           WorkflowStage   @relation(fields: [stageId], references: [id])
  
  contractorId    Int?
  contractor      Contractor?     @relation(fields: [contractorId], references: [id])
  
  // Assignment
  assignedTo      Int?
  assignee        User?           @relation(fields: [assignedTo], references: [id])
  
  // Status
  status          WorkflowStatus  @default(PENDING)
  
  // Quantities
  quantityIn      Int             @default(0)
  quantityOut     Int             @default(0)
  quantityWaste   Int             @default(0)
  
  // Dates
  startDate       DateTime?
  endDate         DateTime?
  dueDate         DateTime?
  
  // Notes
  notes           String?
  internalNotes   String?
  
  // Relations
  history         StageHistory[]
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([orderItemId])
  @@index([stageId])
  @@index([contractorId])
  @@index([status])
  @@index([assignedTo])
}

model WorkflowStage {
  id              Int               @id @default(autoincrement())
  name            String            // Ù¾Ø§Ø±Ú†Ù‡ØŒ Ø¨Ø±Ø´ØŒ Ø¯ÙˆØ®ØªØŒ Ø³Ù†Ú¯â€ŒØ´ÙˆÛŒÛŒØŒ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
  slug            String            @unique // fabric, cutting, sewing, wash, packaging
  displayOrder    Int               @default(0)
  description     String?
  
  // Stage Type
  type            StageType         // INTERNAL, EXTERNAL
  
  // Default contractor type for this stage
  defaultContractorTypeId Int?
  
  isActive        Boolean           @default(true)
  
  // Relations
  workflows       OrderWorkflow[]
  
  createdAt       DateTime          @default(now())
  
  @@index([slug])
  @@index([displayOrder])
}

model StageHistory {
  id              Int             @id @default(autoincrement())
  
  workflowId      Int
  workflow        OrderItemWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  
  // What changed - using enum for type safety
  action          StageAction
  
  // Quantities
  quantity        Int?
  wasteQty        Int?
  
  // Contractor (if external)
  contractorId    Int?
  contractor      Contractor?     @relation(fields: [contractorId], references: [id])
  
  // Notes
  notes           String?
  
  createdBy       Int
  createdAt       DateTime        @default(now())
  
  @@index([workflowId])
  @@index([createdAt])
}

enum StageAction {
  STARTED         // Ø´Ø±ÙˆØ¹ Ù…Ø±Ø­Ù„Ù‡
  COMPLETED       // ØªÚ©Ù…ÛŒÙ„ Ù…Ø±Ø­Ù„Ù‡
  TRANSFERRED     // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯
  WASTE_RECORDED  // Ø«Ø¨Øª Ø¶Ø§ÛŒØ¹Ø§Øª
  ON_HOLD         // ØªÙˆÙ‚Ù Ù…ÙˆÙ‚Øª
  RESUMED         // Ø§Ø² Ø³Ø±Ú¯ÛŒØ±ÛŒ
  ASSIGNED        // ØªØ®ØµÛŒØµ Ø¨Ù‡ Ø´Ø®Øµ/Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø±
}

enum WorkflowStatus {
  PENDING         // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
  IN_PROGRESS     // Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…
  COMPLETED       // ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡
  ON_HOLD         // Ù…ØªÙˆÙ‚Ù Ø´Ø¯Ù‡
  CANCELLED       // Ù„ØºÙˆ Ø´Ø¯Ù‡
}

enum StageType {
  INTERNAL        // Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø®Ù„ÛŒ
  EXTERNAL        // Ø¨Ø±ÙˆÙ†â€ŒØ³Ù¾Ø§Ø±ÛŒ
}
```

**Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:**
- Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ù‡Ø± Ø³ÙØ§Ø±Ø´ Ø¯Ø± Ù…Ø±Ø§Ø­Ù„ Ù…Ø®ØªÙ„Ù
- ØªØ®ØµÛŒØµ Ø¨Ù‡ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± Ø¯Ø± Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡
- Ø«Ø¨Øª ÙˆØ±ÙˆØ¯ÛŒ/Ø®Ø±ÙˆØ¬ÛŒ/Ø¶Ø§ÛŒØ¹Ø§Øª Ø¯Ø± Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡
- ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„ ØªØºÛŒÛŒØ±Ø§Øª

---

### 6. Contractors (Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ)
```prisma
model Contractor {
  id              Int               @id @default(autoincrement())
  name            String            @unique
  code            String?           @unique
  
  typeId          Int
  type            ContractorType    @relation(fields: [typeId], references: [id])
  
  // Contact Info
  phone           String?
  mobile          String?
  email           String?
  address         String?
  
  // Financial
  creditLimit     Decimal?
  paymentTerms    String?           // Ù†Ù‚Ø¯ÛŒØŒ Ú†Ú© 30 Ø±ÙˆØ²Ù‡...
  
  // Status
  isActive        Boolean           @default(true)
  // Note: rating is computed from evaluations, not stored directly
  
  // Notes
  notes           String?
  
  // Relations
  evaluations     ContractorEvaluation[]
  orderItemWorkflows OrderItemWorkflow[]
  stageHistories  StageHistory[]
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  @@index([typeId])
  @@index([isActive])
  @@index([code])
}

model ContractorType {
  id              Int               @id @default(autoincrement())
  name            String            @unique  // Ù¾Ø§Ø±Ú†Ù‡ØŒ ØªÙˆÙ„ÛŒØ¯ÛŒØŒ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒØŒ Ø³Ù†Ú¯â€ŒØ´ÙˆÛŒÛŒ
  slug            String            @unique  // fabric, production, packaging, stone-wash
  description     String?
  isActive        Boolean           @default(true)
  
  contractors     Contractor[]
  
  createdAt       DateTime          @default(now())
}

model EvaluationCriteria {
  id              Int                   @id @default(autoincrement())
  name            String                @unique
  slug            String                @unique
  description     String?
  weight          Int                   @default(1)  // ÙˆØ²Ù† Ø§Ù…ØªÛŒØ§Ø²
  isActive        Boolean               @default(true)
  
  evaluations     ContractorEvaluation[]
  
  createdAt       DateTime              @default(now())
}

model ContractorEvaluation {
  id              Int                 @id @default(autoincrement())
  
  contractorId    Int
  contractor      Contractor          @relation(fields: [contractorId], references: [id], onDelete: Cascade)
  
  criteriaId      Int
  criteria        EvaluationCriteria  @relation(fields: [criteriaId], references: [id])
  
  evaluatedBy     Int
  evaluator       User                @relation(fields: [evaluatedBy], references: [id])
  
  // Rating (1-5)
  score           Int
  
  // Related Order
  orderId         Int?
  
  comments        String?
  createdAt       DateTime            @default(now())
  
  @@index([contractorId])
  @@index([criteriaId])
  @@index([evaluatedBy])
  @@index([orderId])
}
```

**ØªØºÛŒÛŒØ±Ø§Øª:**
- ØªÙÚ©ÛŒÚ© Ù†ÙˆØ¹ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
- Ø³ÛŒØ³ØªÙ… Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ú†Ù†Ø¯Ù…Ø¹ÛŒØ§Ø±Ù‡
- Ú©Ø¯ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ù‡Ú¯ÛŒØ±ÛŒ
- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„ÛŒ

---

### 7. Inventory (Ø¬Ø¯ÛŒØ¯ - Ø³ÛŒØ³ØªÙ… Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ)

Ø¬Ø¯ÙˆÙ„ Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ Ø¯Ùˆ Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ ØªÙ‚Ø³ÛŒÙ… Ø´Ø¯Ù‡ ØªØ§ nullable fields Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ…:

```prisma
// Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ
model ProductInventory {
  id              Int               @id @default(autoincrement())
  
  // Reference
  referenceType   String            // ORDER, ADJUSTMENT, RETURN
  referenceId     Int
  
  // Movement Type
  type            InventoryType     // IN, OUT, ADJUSTMENT
  
  // Product (always present for ProductInventory)
  productId       Int
  product         Product           @relation(fields: [productId], references: [id])
  
  // Quantity
  quantity        Int
  unit            String            // piece
  
  // Location
  warehouseId     Int?
  warehouse       Warehouse?        @relation(fields: [warehouseId], references: [id])
  
  // Details
  batchNumber     String?
  
  notes           String?
  
  // Audit
  createdBy       Int
  creator         User              @relation(fields: [createdBy], references: [id])
  createdAt       DateTime          @default(now())
  
  @@index([referenceType, referenceId])
  @@index([productId])
  @@index([type])
  @@index([createdAt])
}

// Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ Ù…Ù„Ø²ÙˆÙ…Ø§Øª
model MaterialInventory {
  id              Int               @id @default(autoincrement())
  
  // Reference
  referenceType   String            // ORDER_WORKFLOW, PURCHASE, ADJUSTMENT, WASTE
  referenceId     Int
  
  // Movement Type
  type            InventoryType     // IN, OUT, ADJUSTMENT
  
  // Material (always present for MaterialInventory)
  materialId      Int
  material        Material          @relation(fields: [materialId], references: [id])
  
  // Quantity
  quantity        Int
  unit            String            // meter, kg, piece
  
  // Location
  warehouseId     Int?
  warehouse       Warehouse?        @relation(fields: [warehouseId], references: [id])
  
  // Details
  batchNumber     String?
  expiryDate      DateTime?
  
  notes           String?
  
  // Audit
  createdBy       Int
  creator         User              @relation(fields: [createdBy], references: [id])
  createdAt       DateTime          @default(now())
  
  @@index([referenceType, referenceId])
  @@index([materialId])
  @@index([type])
  @@index([createdAt])
}

model Warehouse {
  id              Int           @id @default(autoincrement())
  name            String
  code            String?       @unique
  address         String?
  isActive        Boolean       @default(true)
  
  productInventories  ProductInventory[]
  materialInventories MaterialInventory[]
  
  createdAt       DateTime      @default(now())
}

enum InventoryType {
  IN              // ÙˆØ±ÙˆØ¯
  OUT             // Ø®Ø±ÙˆØ¬
  ADJUSTMENT      // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆØ¬ÙˆØ¯ÛŒ
  RETURN          // Ø¨Ø±Ú¯Ø´Øª
  WASTE           // Ø¶Ø§ÛŒØ¹Ø§Øª
}
```

---

### 8. Materials & Accessories (Ø¬Ø¯ÛŒØ¯)
```prisma
model Material {
  id              Int               @id @default(autoincrement())
  name            String
  code            String?           @unique
  
  typeId          Int
  type            MaterialType      @relation(fields: [typeId], references: [id])
  
  // Unit
  unit            String            // meter, kg, piece
  
  // Stock thresholds (not current stock - that's calculated from movements)
  minStock        Int               @default(0)
  maxStock        Int?              // Ø¨Ø±Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯
  
  // Pricing
  lastPrice       Decimal?
  
  isActive        Boolean           @default(true)
  
  // Relations
  suppliers       MaterialSupplier[]
  usages          MaterialUsage[]
  inventory       MaterialInventory[]
  
  // Note: currentStock should be calculated from MaterialInventory movements
  // Use a view or computed field instead of storing directly
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  @@index([typeId])
  @@index([code])
}

model MaterialType {
  id          Int         @id @default(autoincrement())
  name        String      @unique
  slug        String      @unique
  description String?
  isActive    Boolean     @default(true)
  
  materials   Material[]
  
  createdAt   DateTime    @default(now())
}

model MaterialSupplier {
  id              Int         @id @default(autoincrement())
  materialId      Int
  material        Material    @relation(fields: [materialId], references: [id], onDelete: Cascade)
  
  contractorId    Int
  contractor      Contractor  @relation(fields: [contractorId], references: [id])
  
  isDefault       Boolean     @default(false)
  price           Decimal?
  
  @@unique([materialId, contractorId])
}

model MaterialUsage {
  id              Int             @id @default(autoincrement())
  
  materialId      Int
  material        Material        @relation(fields: [materialId], references: [id])
  
  // Usage in
  referenceType   String          // ORDER_WORKFLOW, PRODUCT_BOM
  referenceId     Int
  
  quantity        Int
  unit            String
  
  notes           String?
  createdAt       DateTime        @default(now())
  
  @@index([materialId])
  @@index([referenceType, referenceId])
}
```

---

### 8.1 Views Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª (Computed Fields)

Ø¨Ù‡ Ø¬Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ… Ù…ÙˆØ¬ÙˆØ¯ÛŒØŒ Ø§Ø² View ÛŒØ§ Stored Procedure Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:

```sql
-- View Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
CREATE VIEW material_stock_view AS
SELECT 
  m.id AS materialId,
  m.name,
  m.code,
  m.minStock,
  m.maxStock,
  COALESCE(SUM(CASE 
    WHEN mi.type = 'IN' THEN mi.quantity 
    WHEN mi.type = 'OUT' THEN -mi.quantity 
    WHEN mi.type = 'ADJUSTMENT' THEN mi.quantity
    ELSE 0 
  END), 0) AS currentStock,
  CASE 
    WHEN COALESCE(SUM(CASE 
      WHEN mi.type = 'IN' THEN mi.quantity 
      WHEN mi.type = 'OUT' THEN -mi.quantity 
      WHEN mi.type = 'ADJUSTMENT' THEN mi.quantity
      ELSE 0 
    END), 0) <= m.minStock THEN 'LOW'
    WHEN m.maxStock IS NOT NULL AND COALESCE(SUM(CASE 
      WHEN mi.type = 'IN' THEN mi.quantity 
      WHEN mi.type = 'OUT' THEN -mi.quantity 
      WHEN mi.type = 'ADJUSTMENT' THEN mi.quantity
      ELSE 0 
    END), 0) >= m.maxStock THEN 'HIGH'
    ELSE 'OK'
  END AS stockStatus
FROM materials m
LEFT JOIN material_inventories mi ON m.id = mi.materialId
WHERE m.isActive = true
GROUP BY m.id, m.name, m.code, m.minStock, m.maxStock;

-- View Ø¨Ø±Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒâ€ŒÙ‡Ø§)
CREATE VIEW contractor_rating_view AS
SELECT 
  c.id AS contractorId,
  c.name,
  COALESCE(AVG(ce.score), 0) AS averageRating,
  COUNT(ce.id) AS evaluationCount,
  COALESCE(AVG(CASE WHEN ce.createdAt >= DATE_SUB(NOW(), INTERVAL 3 MONTH) THEN ce.score END), 0) AS recentRating
FROM contractors c
LEFT JOIN contractor_evaluations ce ON c.id = ce.contractorId
WHERE c.isActive = true
GROUP BY c.id, c.name;
```

**Ø¯Ø± Prisma:**
```prisma
// Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² View Ø¯Ø± Prisma
// Ø¯Ø± migrate dev Ø§ÙˆÙ„ view Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³:
model MaterialStockView {
  materialId    Int       @id
  name          String
  code          String?
  minStock      Int
  maxStock      Int?
  currentStock  Int
  stockStatus   String    // LOW, OK, HIGH
  
  @@map("material_stock_view")
}

model ContractorRatingView {
  contractorId      Int       @id
  name              String
  averageRating     Float
  evaluationCount   Int
  recentRating      Float
  
  @@map("contractor_rating_view")
}
```

---

### 9. Settings & Lookups (Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ)
```prisma
model Setting {
  id          Int       @id @default(autoincrement())
  key         String    @unique
  value       String
  group       String    @default("general") // general, system, appearance
  type        String    @default("string")  // string, number, boolean, json
  isEditable  Boolean   @default(true)
  description String?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([group])
}

// Keep existing lookup tables with improvements
model Style {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  code        String?   @unique
  description String?
  isActive    Boolean   @default(true)
  
  products    Product[]
  
  createdAt   DateTime  @default(now())
}

model Fabric {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  code        String?   @unique
  description String?
  isActive    Boolean   @default(true)
  
  products    Product[]
  
  createdAt   DateTime  @default(now())
}
```

---

### 10. Audit Logs (Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ)
```prisma
model AuditLog {
  id            Int       @id @default(autoincrement())
  
  userId        Int
  user          User      @relation(fields: [userId], references: [id])
  
  action        String    // CREATE, UPDATE, DELETE, LOGIN, EXPORT
  entityType    String    // Order, User, Contractor...
  entityId      Int?
  
  // Changes stored as JSON
  oldValues     Json?
  newValues     Json?
  
  // Request Info
  ipAddress     String?
  userAgent     String?
  
  createdAt     DateTime  @default(now())
  
  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([entityId])
  @@index([createdAt])
}
```

---

## ğŸ”§ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¯Ø± Ø¨Ú©â€ŒØ§Ù†Ø¯

### 1. Ø³Ø§Ø®ØªØ§Ø± RouteÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

```
backend/src/
â”œâ”€â”€ index.js
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.js
â”‚   â”œâ”€â”€ auth.js
â”‚   â””â”€â”€ constants.js
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ checkPermission.js    // â† Ø¬Ø¯ÛŒØ¯
â”‚   â”œâ”€â”€ validate.js
â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â””â”€â”€ audit.js
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ users.js
â”‚   â”œâ”€â”€ roles.js
â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ items.js
â”‚   â”‚   â”œâ”€â”€ workflow.js
â”‚   â”‚   â””â”€â”€ reports.js
â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ categories.js
â”‚   â”‚   â””â”€â”€ prices.js
â”‚   â”œâ”€â”€ contractors/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ types.js
â”‚   â”‚   â””â”€â”€ evaluations.js
â”‚   â”œâ”€â”€ inventory/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ movements.js
â”‚   â”‚   â””â”€â”€ warehouses.js
â”‚   â”œâ”€â”€ materials/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ types.js
â”‚   â”‚   â””â”€â”€ usage.js
â”‚   â”œâ”€â”€ sizes/
â”‚   â”‚   â”œâ”€â”€ categories.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ settings.js
â”‚   â””â”€â”€ reports.js
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ order.service.js
â”‚   â”œâ”€â”€ workflow.service.js
â”‚   â”œâ”€â”€ inventory.service.js
â”‚   â”œâ”€â”€ report.service.js
â”‚   â””â”€â”€ export.service.js
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ prisma.js
â”‚   â”œâ”€â”€ helpers.js
â”‚   â””â”€â”€ validators/
â”‚       â”œâ”€â”€ order.validator.js
â”‚       â”œâ”€â”€ product.validator.js
â”‚       â””â”€â”€ user.validator.js
â””â”€â”€ jobs/
    â”œâ”€â”€ backup.js
    â””â”€â”€ notifications.js
```

### 2. Permission Middleware (Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ)

```javascript
// middleware/checkPermission.js
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

/**
 * Middleware Ø¨Ø±Ø§ÛŒ Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø±
 * @param {string} resource - Ù…Ù†Ø¨Ø¹ (orders, contractors, etc.)
 * @param {string} action - Ø¹Ù…Ù„ (create, read, update, delete)
 * @returns {Function} Express middleware
 */
const checkPermission = (resource, action) => {
  return async (req, res, next) => {
    try {
      const user = req.user; // Ø§Ø² JWT Ù…ÛŒØ§Ø¯ (set by auth middleware)
      
      if (!user) {
        return res.status(401).json({ error: 'Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù†Ø´Ø¯Ù‡' });
      }
      
      // Admin Ù‡Ù…ÛŒØ´Ù‡ Ø±Ø¯ Ù…ÛŒØ´Ù‡
      if (user.role?.slug === 'admin') {
        return next();
      }
      
      // Ú†Ú© Ú©Ù† permission ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù‡ØŸ
      const permission = await prisma.permission.findFirst({
        where: {
          roleId: user.roleId,
          OR: [
            { resource: '*', action: '*' }, // wildcard permission
            { resource, action: '*' },      // wildcard action
            { resource, action },           // exact match
          ]
        }
      });
      
      if (!permission) {
        return res.status(403).json({ 
          error: 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª',
          resource,
          action
        });
      }
      
      // Ø§Ú¯Ù‡ scope = 'own' Ø¨ÙˆØ¯ØŒ ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ¯Ø´ Ø±Ùˆ Ø¨Ø¨ÛŒÙ†Ù‡
      if (permission.scope === 'own') {
        req.filterByUser = user.id;
        req.userScope = 'own';
      } else if (permission.scope === 'department') {
        req.userScope = 'department';
        req.userDepartment = user.departmentId; // Ø§Ú¯Ù‡ Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯
      } else {
        req.userScope = 'all';
      }
      
      next();
    } catch (error) {
      console.error('Permission check error:', error);
      res.status(500).json({ error: 'Ø®Ø·Ø§ Ø¯Ø± Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ' });
    }
  };
};

/**
 * Middleware ØªØ±Ú©ÛŒØ¨ÛŒ: Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª + Ø¯Ø³ØªØ±Ø³ÛŒ
 */
const requirePermission = (resource, action) => {
  const { authenticate } = require('./auth');
  return [authenticate, checkPermission(resource, action)];
};

module.exports = { 
  checkPermission, 
  requirePermission 
};
```

#### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± RouteÙ‡Ø§

```javascript
// routes/orders.js
const { Router } = require('express');
const { requirePermission } = require('../middleware/checkPermission');
const orderController = require('../controllers/order.controller');

const router = Router();

// Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆÙ†Ù† Ø¨Ø¨ÛŒÙ†Ù† (Ø¨Ø§ scope 'own' Ø¨Ø±Ø§ÛŒ sales)
router.get('/', 
  ...requirePermission('orders', 'read'),
  orderController.list
);

// ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ùˆ ÙØ±ÙˆØ´ Ù…ÛŒâ€ŒØªÙˆÙ†Ù† Ø«Ø¨Øª Ú©Ù†Ù†
router.post('/',
  ...requirePermission('orders', 'create'),
  orderController.create
);

// ÙÙ‚Ø· Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†Ù‡
router.put('/:id',
  ...requirePermission('orders', 'update'),
  orderController.update
);

// ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø­Ø°Ù Ú©Ù†Ù‡
router.delete('/:id',
  ...requirePermission('orders', 'delete'),
  orderController.delete
);

module.exports = router;
```

#### Ù…Ø¯ÛŒØ±ÛŒØª Scope Ø¯Ø± Controller

```javascript
// controllers/order.controller.js
const listOrders = async (req, res) => {
  try {
    const where = {};
    
    // Ø§Ú¯Ù‡ scope = 'own' Ø¨ÙˆØ¯ØŒ ÙÙ‚Ø· Ø³ÙØ§Ø±Ø´Ø§Øª Ø®ÙˆØ¯Ø´
    if (req.userScope === 'own') {
      where.createdBy = req.filterByUser;
    }
    
    const orders = await prisma.order.findMany({
      where,
      include: { items: true },
      orderBy: { createdAt: 'desc' }
    });
    
    res.json({ orders, scope: req.userScope });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};

module.exports = { listOrders };
```

---

### 3. Frontend Hook Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ

```javascript
// hooks/usePermission.js
import { useMemo } from 'react';
import { useAuthStore } from '../store/authStore';

/**
 * Hook Ø¨Ø±Ø§ÛŒ Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø±
 * @param {string} resource - Ù…Ù†Ø¨Ø¹
 * @param {string} action - Ø¹Ù…Ù„
 * @returns {boolean} Ø¢ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ù‡ØŸ
 */
export function usePermission(resource, action) {
  const { user } = useAuthStore();
  
  return useMemo(() => {
    if (!user) return false;
    
    // Admin Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ù‡
    if (user.role?.slug === 'admin') return true;
    
    // Ú†Ú© Ú©Ø±Ø¯Ù† permissions
    return user.permissions?.some(
      p => (p.resource === resource || p.resource === '*') &&
           (p.action === action || p.action === '*')
    );
  }, [user, resource, action]);
}

/**
 * Hook Ø¨Ø±Ø§ÛŒ Ú†Ú© Ú©Ø±Ø¯Ù† Ú†Ù†Ø¯ Ø¯Ø³ØªØ±Ø³ÛŒ
 * @param {Array<{resource: string, action: string}>} permissions
 * @returns {Object} object Ø¨Ø§ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ resource_action
 */
export function usePermissions(permissions) {
  const { user } = useAuthStore();
  
  return useMemo(() => {
    const result = {};
    
    permissions.forEach(({ resource, action }) => {
      const key = `${resource}_${action}`;
      
      if (!user) {
        result[key] = false;
        return;
      }
      
      if (user.role?.slug === 'admin') {
        result[key] = true;
        return;
      }
      
      result[key] = user.permissions?.some(
        p => (p.resource === resource || p.resource === '*') &&
             (p.action === action || p.action === '*')
      );
    });
    
    return result;
  }, [user, permissions]);
}
```

#### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§

```jsx
// components/OrderPage.jsx
import { usePermission, usePermissions } from '../hooks/usePermission';

function OrderPage() {
  // Ú†Ú© Ú©Ø±Ø¯Ù† ØªÚ© Ø¯Ø³ØªØ±Ø³ÛŒ
  const canCreate = usePermission('orders', 'create');
  const canDelete = usePermission('orders', 'delete');
  
  // ÛŒØ§ Ú†Ú© Ú©Ø±Ø¯Ù† Ú†Ù†Ø¯ Ø¯Ø³ØªØ±Ø³ÛŒ ÛŒÚ©Ø¬Ø§
  const perms = usePermissions([
    { resource: 'orders', action: 'create' },
    { resource: 'orders', action: 'update' },
    { resource: 'orders', action: 'delete' },
    { resource: 'reports', action: 'read' },
  ]);
  
  return (
    <div>
      <h1>Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª</h1>
      
      {perms.orders_create && (
        <button className="btn-primary">
          Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯
        </button>
      )}
      
      {perms.orders_delete && (
        <button className="btn-danger">
          Ø­Ø°Ù Ø³ÙØ§Ø±Ø´
        </button>
      )}
      
      {perms.reports_read && (
        <button className="btn-secondary">
          Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú¯Ø²Ø§Ø±Ø´Ø§Øª
        </button>
      )}
    </div>
  );
}

export default OrderPage;
```

---

### 4. Ù†Ú©Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ âš ï¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  Ù…Ù‡Ù…: Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ùˆ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Backend Ú†Ú© Ú©Ù†!                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âŒ Ø§Ø´ØªØ¨Ø§Ù‡: ÙÙ‚Ø· UI Ø±Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù†                            â”‚
â”‚     - ÛŒÙ‡ Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ API Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø²Ù†Ù‡          â”‚
â”‚     - DevTools Ø¨Ø§Ø² Ú©Ù†Ù‡ Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨ÙØ±Ø³ØªÙ‡                     â”‚
â”‚     - Postman/Insomnia Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù‡                          â”‚
â”‚                                                              â”‚
â”‚  âœ… Ø¯Ø±Ø³Øª: Middleware Ø±ÙˆÛŒ Ù‡Ù…Ù‡ EndpointÙ‡Ø§                     â”‚
â”‚     - checkPermission Ø±ÙˆÛŒ ØªÙ…Ø§Ù… routeÙ‡Ø§                      â”‚
â”‚     - Ø­ØªÛŒ Ø§Ú¯Ù‡ UI Ø¯Ú©Ù…Ù‡ Ø±Ùˆ Ù†Ø´ÙˆÙ† Ù†Ø¯Ù‡ØŒ API Ù…Ø­Ø§ÙØ¸Øª Ø´Ø¯Ù‡ Ø§Ø³Øª      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Ú†Ú© Ù„ÛŒØ³Øª Ø§Ù…Ù†ÛŒØªÛŒ:
- [ ] `checkPermission` Ø±ÙˆÛŒ **Ù‡Ù…Ù‡** API endpoints
- [ ] Ø­ØªÛŒ endpointÙ‡Ø§ÛŒ read Ø³Ø§Ø¯Ù‡ Ù‡Ù… Ù…Ø­Ø§ÙØ¸Øª Ø´Ù†
- [ ] scope 'own' Ø¯Ø± controller Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´ÙˆØ¯
- [ ] Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²
- [ ] Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Rate Limiting)

---

### 5. API Endpoints Ø¬Ø¯ÛŒØ¯

#### Orders Module
```javascript
// CRUD Orders
GET    /api/orders                    // Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨Ø§ ÙÛŒÙ„ØªØ±
POST   /api/orders                    // Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´
GET    /api/orders/:id                // Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´
PUT    /api/orders/:id                // ÙˆÛŒØ±Ø§ÛŒØ´ Ø³ÙØ§Ø±Ø´
DELETE /api/orders/:id                // Ø­Ø°Ù Ø³ÙØ§Ø±Ø´ (Admin)

// Order Items
GET    /api/orders/:id/items          // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´
POST   /api/orders/:id/items          // Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒØªÙ…
PUT    /api/orders/:id/items/:itemId  // ÙˆÛŒØ±Ø§ÛŒØ´ Ø¢ÛŒØªÙ…
DELETE /api/orders/:id/items/:itemId  // Ø­Ø°Ù Ø¢ÛŒØªÙ…

// Order Item Workflow (Workflow per item, not per order)
GET    /api/orders/:id/items/:itemId/workflow       // Ù…Ø±Ø§Ø­Ù„ Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø± Ø¢ÛŒØªÙ…
POST   /api/orders/:id/items/:itemId/workflow       // Ø´Ø±ÙˆØ¹ Ù…Ø±Ø­Ù„Ù‡
PUT    /api/orders/:id/items/:itemId/workflow/:wfId // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø±Ø­Ù„Ù‡
POST   /api/orders/:id/items/:itemId/workflow/:wfId/transfer  // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯
POST   /api/orders/:id/items/:itemId/workflow/:wfId/waste     // Ø«Ø¨Øª Ø¶Ø§ÛŒØ¹Ø§Øª

// Order Status Management
PUT    /api/orders/:id/status         // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´
PUT    /api/orders/:id/priority       // ØªØºÛŒÛŒØ± Ø§ÙˆÙ„ÙˆÛŒØª

// Payments
GET    /api/orders/:id/payments       // Ù„ÛŒØ³Øª Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
POST   /api/orders/:id/payments       // Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¬Ø¯ÛŒØ¯
PUT    /api/orders/:id/payments/:paymentId  // ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
```

#### Products Module
```javascript
// Products
GET    /api/products
POST   /api/products
GET    /api/products/:id
PUT    /api/products/:id
DELETE /api/products/:id

// Product Sizes
GET    /api/products/:id/sizes
POST   /api/products/:id/sizes
DELETE /api/products/:id/sizes/:sizeId

// Product Categories
GET    /api/products/categories
POST   /api/products/categories

// Product Prices
GET    /api/products/:id/prices
POST   /api/products/:id/prices
```

#### Size Management
```javascript
// Size Categories
GET    /api/sizes/categories
POST   /api/sizes/categories
PUT    /api/sizes/categories/:id
DELETE /api/sizes/categories/:id

// Sizes
GET    /api/sizes?category=:categoryId
POST   /api/sizes
PUT    /api/sizes/:id
DELETE /api/sizes/:id
```

#### Inventory Module (Split into Product and Material)
```javascript
// Product Inventory
GET    /api/inventory/products                    // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
GET    /api/inventory/products/movements          // Ú¯Ø±Ø¯Ø´ Ø§Ù†Ø¨Ø§Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª
POST   /api/inventory/products/in                 // ÙˆØ±ÙˆØ¯ Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø±
POST   /api/inventory/products/out                // Ø®Ø±ÙˆØ¬ Ù…Ø­ØµÙˆÙ„ Ø§Ø² Ø§Ù†Ø¨Ø§Ø±
POST   /api/inventory/products/adjust             // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„

// Material Inventory
GET    /api/inventory/materials                   // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
GET    /api/inventory/materials/movements         // Ú¯Ø±Ø¯Ø´ Ø§Ù†Ø¨Ø§Ø± Ù…ÙˆØ§Ø¯
POST   /api/inventory/materials/in                // ÙˆØ±ÙˆØ¯ Ù…Ø§Ø¯Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
POST   /api/inventory/materials/out               // Ø®Ø±ÙˆØ¬ Ù…Ø§Ø¯Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
POST   /api/inventory/materials/adjust            // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø§Ø¯Ù‡

// Stock Views (Computed)
GET    /api/inventory/materials/stock-levels      // Ø³Ø·Ø­ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…ÙˆØ§Ø¯ (from view)
GET    /api/inventory/materials/low-stock         // Ù‡Ø´Ø¯Ø§Ø± Ú©Ù…Ø¨ÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ

// Warehouses
GET    /api/inventory/warehouses
POST   /api/inventory/warehouses
PUT    /api/inventory/warehouses/:id
```

#### Contractors Module
```javascript
// Contractors
GET    /api/contractors
POST   /api/contractors
GET    /api/contractors/:id
PUT    /api/contractors/:id
DELETE /api/contractors/:id

// Contractor Evaluations
GET    /api/contractors/:id/evaluations
POST   /api/contractors/:id/evaluations

// Contractor Stats (Computed from evaluations)
GET    /api/contractors/:id/stats        // Ø¢Ù…Ø§Ø± Ùˆ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒâ€ŒÙ‡Ø§
GET    /api/contractors/ratings          // Ù„ÛŒØ³Øª Ø§Ù…ØªÛŒØ§Ø²Ø§Øª (from view)

// Contractor Types
GET    /api/contractors/types
```

#### Reports Module
```javascript
// Reports
GET    /api/reports/orders               // Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª
GET    /api/reports/production           // Ú¯Ø²Ø§Ø±Ø´ ØªÙˆÙ„ÛŒØ¯
GET    /api/reports/inventory            // Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
GET    /api/reports/contractors          // Ú¯Ø²Ø§Ø±Ø´ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø±Ø§Ù†
GET    /api/reports/financial            // Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ

// Exports
GET    /api/reports/export/orders        // Ø®Ø±ÙˆØ¬ÛŒ Excel
GET    /api/reports/export/production
GET    /api/reports/export/inventory
```

### 3. Services Layer (Business Logic)

#### Order Service
```javascript
// services/order.service.js
class OrderService {
  // Create order with items
  async createOrder(orderData, items) {
    // Validate product availability
    // Calculate totals
    // Create order
    // Create order items with sizes
    // Initialize workflow
    // Log audit
  }
  
  // Update order status
  async updateStatus(orderId, status, notes) {
    // Validate status transition
    // Update status
    // Notify relevant users
    // Log audit
  }
  
  // Get order with full details
  async getOrderDetails(orderId) {
    // Include: items, sizes, workflow, history
  }
  
  // Search orders
  async searchOrders(filters) {
    // Filter by: status, date range, customer, product
  }
}
```

#### Workflow Service
```javascript
// services/workflow.service.js
class WorkflowService {
  // Initialize workflow for order
  async initializeWorkflow(orderId) {
    // Create workflow stages based on product type
  }
  
  // Start stage
  async startStage(workflowId, contractorId, quantity) {
    // Validate quantity
    // Update stage status
    // Log history
  }
  
  // Complete stage
  async completeStage(workflowId, outputQty, wasteQty) {
    // Calculate waste percentage
    // Update stage
    // Transfer to next stage
  }
  
  // Get workflow progress
  async getProgress(orderId) {
    // Calculate percentage complete
    // Return timeline
  }
}
```

#### Inventory Service
```javascript
// services/inventory.service.js
class InventoryService {
  // Stock in
  async stockIn(data) {
    // Update inventory
    // Log movement
    // Update product stock
  }
  
  // Stock out
  async stockOut(data) {
    // Check availability
    // Update inventory
    // Log movement
  }
  
  // Get stock level
  async getStockLevel(productId) {
    // Calculate from movements
  }
  
  // Get low stock alerts
  async getLowStockAlerts() {
    // Return products below min stock
  }
}
```

### 4. Validation Layer

```javascript
// validators/order.validator.js
const Joi = require('joi');

const orderSchema = Joi.object({
  customerName: Joi.string().required().min(2).max(200),
  customerPhone: Joi.string().allow(''),
  deliveryDate: Joi.date().min('now'),
  priority: Joi.string().valid('LOW', 'NORMAL', 'HIGH', 'URGENT'),
  description: Joi.string().allow(''),
  items: Joi.array().items(
    Joi.object({
      productId: Joi.number().required(),
      quantity: Joi.number().integer().min(1).required(),
      unitPrice: Joi.number().min(0),
      sizes: Joi.array().items(
        Joi.object({
          sizeCategoryId: Joi.number().required(),
          sizeId: Joi.number().required(),
          quantity: Joi.number().integer().min(0).required()
        })
      )
    })
  ).min(1)
});

module.exports = { orderSchema };
```

---

## ğŸ”„ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Migration

### Ù…Ø±Ø§Ø­Ù„ Migration Ø§Ø² Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¯ÛŒÙ…

```javascript
// migrations/migrate-orders.js
async function migrateOrders() {
  // 1. Create new size categories
  const categories = [
    { name: 'Ø³Ø§Ù„Ù…', slug: 'healthy', displayOrder: 1 },
    { name: 'Ø§Ù‚ØªØµØ§Ø¯ÛŒ 1', slug: 'economy-1', displayOrder: 2 },
    { name: 'Ø§Ù‚ØªØµØ§Ø¯ÛŒ 2', slug: 'economy-2', displayOrder: 3 },
    { name: 'Ø§Ù‚ØªØµØ§Ø¯ÛŒ 3', slug: 'economy-3', displayOrder: 4 },
    { name: 'Ù†Ù…ÙˆÙ†Ù‡', slug: 'sample', displayOrder: 5 },
    { name: 'Ø§Ø³ØªÙˆÚ©', slug: 'stock', displayOrder: 6 },
  ];
  
  // 2. Create sizes (30-40)
  const sizeNumbers = [30, 31, 32, 33, 34, 36, 38, 40];
  
  // 3. Migrate each old order
  const oldOrders = await prisma.oldOrder.findMany();
  
  for (const oldOrder of oldOrders) {
    // Create new order
    const newOrder = await prisma.order.create({
      data: {
        orderNumber: oldOrder.code,
        customerName: oldOrder.name,
        orderDate: oldOrder.date,
        status: mapStatus(oldOrder.status),
        createdBy: oldOrder.createdBy,
        createdAt: oldOrder.createdAt,
      }
    });
    
    // Create order item
    const orderItem = await prisma.orderItem.create({
      data: {
        orderId: newOrder.id,
        productId: await getOrCreateProduct(oldOrder),
        quantity: oldOrder.totalCount || 0,
        status: 'PENDING'
      }
    });
    
    // Migrate sizes
    for (const category of categories) {
      for (const sizeNum of sizeNumbers) {
        const oldField = `size${sizeNum}_${category.slug.replace('-', '')}`;
        const quantity = oldOrder[oldField];
        
        if (quantity && quantity > 0) {
          await prisma.orderItemSize.create({
            data: {
              orderItemId: orderItem.id,
              sizeCategoryId: category.id,
              sizeId: await getSizeId(category.id, sizeNum),
              orderedQty: quantity
            }
          });
        }
      }
    }
    
    // Create initial workflow
    await workflowService.initializeWorkflow(newOrder.id);
  }
}
```

---

## ğŸ“± ØªØºÛŒÛŒØ±Ø§Øª Frontend

### Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§

```
frontend/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ DataTable.jsx
â”‚   â”‚   â”œâ”€â”€ FilterBar.jsx
â”‚   â”‚   â”œâ”€â”€ StatCard.jsx
â”‚   â”‚   â””â”€â”€ StatusBadge.jsx
â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”œâ”€â”€ OrderForm/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderInfo.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderItems.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SizeSelector.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â”œâ”€â”€ OrderWorkflow/
â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowTimeline.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StageCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â””â”€â”€ OrderList/
â”‚   â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ inventory/
â”‚   â””â”€â”€ contractors/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Orders/
â”‚   â”‚   â”œâ”€â”€ List.jsx
â”‚   â”‚   â”œâ”€â”€ Create.jsx
â”‚   â”‚   â”œâ”€â”€ Detail.jsx
â”‚   â”‚   â””â”€â”€ Workflow.jsx
â”‚   â”œâ”€â”€ Products/
â”‚   â”œâ”€â”€ Inventory/
â”‚   â””â”€â”€ Reports/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api.js
â”‚   â”œâ”€â”€ order.service.js
â”‚   â”œâ”€â”€ product.service.js
â”‚   â””â”€â”€ inventory.service.js
â””â”€â”€ store/
    â”œâ”€â”€ orderStore.js
    â”œâ”€â”€ productStore.js
    â””â”€â”€ inventoryStore.js
```

---

## ğŸš€ ÙØ§Ø²Ù‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒÛŒ

### ÙØ§Ø² 1: Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ (Ù‡ÙØªÙ‡ 1)
- [ ] Ø·Ø±Ø§Ø­ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø³Ø§Ø®ØªØ§Ø±
- [ ] Ø§ÛŒØ¬Ø§Ø¯ migration scripts
- [ ] Backup Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ù„ÛŒ
- [ ] Setup Ù…Ø­ÛŒØ· ØªØ³Øª

### ÙØ§Ø² 2: Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ùˆ Ù…Ø¯Ù„â€ŒÙ‡Ø§ (Ù‡ÙØªÙ‡ 1-2)
- [ ] Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Prisma
- [ ] Ù†ÙˆØ´ØªÙ† migration scripts
- [ ] ØªØ³Øª migration Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡
- [ ] Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

### ÙØ§Ø² 3: API Layer (Ù‡ÙØªÙ‡ 2-3)
- [ ] Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø§Ø®ØªØ§Ø± route Ø¬Ø¯ÛŒØ¯
- [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ CRUD Ø§ØµÙ„ÛŒ
- [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
- [ ] ØªØ³Øª APIÙ‡Ø§

### ÙØ§Ø² 4: Frontend (Ù‡ÙØªÙ‡ 3-4)
- [ ] Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ ÙØ±Ù… Ø³ÙØ§Ø±Ø´Ø§Øª
- [ ] ØµÙØ­Ù‡ Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø±
- [ ] Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§ÛŒØ²Ù‡Ø§
- [ ] Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯

### ÙØ§Ø² 5: Migration Ø¯Ø§Ø¯Ù‡ (Ù‡ÙØªÙ‡ 4)
- [ ] Ø§Ø¬Ø±Ø§ÛŒ migration Ø±ÙˆÛŒ Ø¯Ø§Ø¯Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ
- [ ] Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
- [ ] Ø±ÙØ¹ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ

### ÙØ§Ø² 6: ØªØ³Øª Ùˆ Ø¯ÛŒÙ¾Ù„ÙˆÛŒ (Ù‡ÙØªÙ‡ 5)
- [ ] ØªØ³Øª Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…
- [ ] Ø¢Ù…ÙˆØ²Ø´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
- [ ] Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ù†Ù‡Ø§ÛŒÛŒ

---

## âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

### Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±ÙˆØ¹
1. **Ø­ØªÙ…Ø§Ù‹ Backup Ø¨Ú¯ÛŒØ±ÛŒØ¯** - Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ù„ÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¨Ú©Ø§Ù¾ Ø´ÙˆØ¯
2. **ØªØ³Øª Ù…Ø­ÛŒØ·** - Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ Ø¯ÛŒØªØ§ÛŒ ØªØ³Øª Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
3. **Ø¨Ø±Ù†Ø§Ù…Ù‡ rollback** - Ø§Ù…Ú©Ø§Ù† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù‚Ø¨Ù„ Ø¨Ø§Ø´Ø¯

### Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§
1. **Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø¨ÙˆØ¯Ù† migration** - Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ Ø²ÛŒØ§Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø¨Ø§Ø´Ø¯
2. **ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø³Ø§Ø³ÛŒ Ø¯Ø± UI** - Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¬Ø¯Ø¯ Ø¯Ø§Ø±Ù†Ø¯
3. **Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ Ù‚Ø¯ÛŒÙ…ÛŒ** - Ø¨Ø±Ø®ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯

### Ù…Ø²Ø§ÛŒØ§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
1. âœ… **Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ** - Ø§Ù…Ú©Ø§Ù† Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØ²/Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯
2. âœ… **Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ú©Ø§Ù…Ù„** - Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ø§Ø² Ø³ÙØ§Ø±Ø´ ØªØ§ ØªØ­ÙˆÛŒÙ„
3. âœ… **Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø¨Ø§Ø±** - Ø³ÛŒØ³ØªÙ… Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„
4. âœ… **Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡** - Ø§Ù…Ú©Ø§Ù† Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù‡Ø± Ø¨Ø®Ø´
5. âœ… **ØªØ¹Ù…ÛŒØ± Ùˆ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø¢Ø³Ø§Ù†** - Ú©Ø¯ ØªÙ…ÛŒØ² Ùˆ Ù‚Ø§Ø¨Ù„ ÙÙ‡Ù…

---

**Ø§ÛŒÙ† Ø³Ø§Ø®ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ø´Ø¯ Ø¨Ù„Ù†Ø¯Ù…Ø¯Øª Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§ÛŒ Ø³ÙØ§Ø±Ø´Ø§Øª Ùˆ Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ø¯.**
